<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>National Strength Card (P99.5) – Rechner</title>
  <style>
    :root{font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#111;}
    body{margin:24px; max-width: 980px;}
    h1{margin:0 0 8px; font-size: 22px;}
    .sub{color:#444; margin:0 0 18px; line-height:1.35}
    .grid{display:grid; grid-template-columns: 1.1fr 0.9fr; gap:18px; align-items:start;}
    @media (max-width: 920px){.grid{grid-template-columns:1fr;}}
    .card{border:1px solid #ddd; border-radius:16px; padding:16px; box-shadow: 0 1px 10px rgba(0,0,0,.06)}
    label{display:block; font-size: 13px; color:#333; margin:10px 0 6px;}
    select,input,button{width:100%; padding:10px 12px; border:1px solid #ccc; border-radius:12px; font-size:14px;}
    button{border-color:#111; background:#111; color:#fff; cursor:pointer;}
    button:active{transform: translateY(1px);}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    .row3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px;}

    /* Lifts: 3 Kacheln */
    .kpi{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;}
    .k{
      border:1px solid rgba(0,0,0,.08);
      border-radius:14px;
      padding:10px 12px;
      background:#fafafa;
      box-shadow: 0 1px 10px rgba(0,0,0,.04);
      position: relative;
      overflow: hidden;
      min-height: 58px;
    }
    .k b{display:block; font-size:12px; color:rgba(0,0,0,.70); font-weight:800; letter-spacing:.2px}
    .k span{display:block; font-size:20px; margin-top:4px; font-weight:900}

    .note{font-size:12px; color:#555; margin-top:10px; line-height:1.35}
    canvas{width:100%; height:auto; border:1px solid #eee; border-radius:16px; background:white}
    .tiny{font-size:12px; color:#555; margin-top:8px}
    code{background:#f6f6f6; padding:2px 6px; border-radius:6px;}

    /* =========================
       TIER STYLES (Lift-Kacheln)
       ========================= */
    .tier-gray   { background: linear-gradient(135deg,#f3f4f6,#e5e7eb); color:#111; }
    .tier-bronze { background: linear-gradient(135deg,#fef3c7,#cd7f32); color:#111; }
    .tier-silver { background: linear-gradient(135deg,#f3f4f6,#c0c0c0); color:#111; }
    .tier-gold   { background: linear-gradient(135deg,#fff7cc,#d4af37); color:#111; }
    .tier-ruby   { background: linear-gradient(135deg,#7f1d1d,#ef4444); color:#fff; }
    .tier-god    { background: linear-gradient(135deg,#5b21b6,#a21caf,#f59e0b); color:#fff; }

    /* leichter Shiny für farbige Lifts */
    .k.tier-bronze::after,
    .k.tier-silver::after,
    .k.tier-gold::after,
    .k.tier-ruby::after,
    .k.tier-god::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(120deg,
        rgba(255,255,255,0) 35%,
        rgba(255,255,255,.22) 45%,
        rgba(255,255,255,0) 55%
      );
      transform: translateX(-60%) rotate(8deg);
      pointer-events:none;
      filter: blur(0.6px);
      animation: shineSweep 3.1s ease-in-out infinite;
      opacity:.6;
    }
    @keyframes shineSweep{
      0%   { transform: translateX(-70%) rotate(8deg); opacity:0; }
      20%  { opacity:.6; }
      50%  { transform: translateX(10%) rotate(8deg); opacity:.45; }
      100% { opacity:0; }
    }
    .tier-ruby b, .tier-god b { color: rgba(255,255,255,.85); }
    .tier-ruby span, .tier-god span { color: #fff; }

    /* =========================
       MEDAILLE (TOTAL)
       ========================= */
    .medalWrap{ margin-top: 12px; display:flex; justify-content:center; }
    .medal {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
      box-shadow:
        inset 0 0 0 6px rgba(255,255,255,.22),
        inset 0 -10px 18px rgba(0,0,0,.25),
        0 14px 28px rgba(0,0,0,.22);
      border: 1px solid rgba(0,0,0,.10);
      text-align:center;
    }
    .medal .value {
      font-size: 44px;
      line-height: 1;
      font-weight: 1000;
      letter-spacing: .5px;
    }
    .medal .label {
      font-size: 11px;
      letter-spacing: .12em;
      opacity: .92;
      margin-top: 8px;
      font-weight: 900;
    }
    .medal .meta {
      margin-top: 6px;
      font-size: 12px;
      opacity: .90;
      font-weight: 700;
    }
    /* Shiny sweep */
    .medal::after {
      content: "";
      position: absolute;
      inset: -35%;
      background: linear-gradient(
        120deg,
        transparent 35%,
        rgba(255,255,255,.40) 45%,
        transparent 55%
      );
      transform: translateX(-60%) rotate(8deg);
      animation: shineMedal 3s infinite ease-in-out;
      pointer-events:none;
    }
    @keyframes shineMedal {
      0% { transform: translateX(-70%) rotate(8deg); opacity: 0; }
      20% { opacity: .95; }
      50% { transform: translateX(10%) rotate(8deg); opacity: .55; }
      100% { opacity: 0; }
    }
    /* medal tier colors */
    .medal.gray   { background: linear-gradient(135deg,#9ca3af,#6b7280); color:#111; }
    .medal.bronze { background: linear-gradient(135deg,#92400e,#d97706); color:#111; }
    .medal.silver { background: linear-gradient(135deg,#9ca3af,#e5e7eb); color:#111; }
    .medal.gold   { background: linear-gradient(135deg,#a16207,#facc15); color:#111; }
    .medal.ruby   { background: linear-gradient(135deg,#7f1d1d,#ef4444); color:#fff; }
    .medal.god    { background: linear-gradient(135deg,#5b21b6,#a21caf,#f59e0b); color:#fff; }
    .medal.ruby .label, .medal.god .label, .medal.ruby .meta, .medal.god .meta {
      color: rgba(255,255,255,.90);
    }

    /* =========================
       MOBILE / STORY MODE
       ========================= */
    @media (max-width: 430px) {
      body { margin: 12px; }
      h1 { font-size: 16px; line-height: 1.2; }
      .sub { font-size: 11px; margin-bottom: 10px; }
      .grid { gap: 12px; }
      .card { padding: 12px; border-radius: 14px; }

      label { font-size: 11px; margin: 6px 0 4px; }
      select, input, button { padding: 8px 10px; font-size: 13px; border-radius: 10px; }
      .row, .row3 { gap: 8px; }

      .kpi { gap: 6px; }
      .k { padding: 8px; border-radius: 10px; min-height: 52px; }
      .k span { font-size: 16px; }

      .medal { width: 140px; height: 140px; }
      .medal .value { font-size: 34px; }
      .medal .label { font-size: 10px; }
      .medal .meta { font-size: 11px; }

      canvas { border-radius: 14px; margin-top: 8px; }
      #capsText { display: none; } /* Caps/SDs ausblenden für Story-Screenshot */
      .tiny { font-size: 11px; }
    }
  </style>
</head>

<body>
  <h1>National Strength Card – 100 = P99.5, 10 Punkte = 1 SD</h1>
  <p class="sub">
    </code>.
  </p>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <div class="row">
        <div>
          <label for="sex">Sex</label>
          <select id="sex">
            <option value="M">Männer</option>
            <option value="F">Frauen</option>
          </select>
        </div>
        <div>
          <label for="wc">Gewichtsklasse</label>
          <select id="wc"></select>
        </div>
      </div>

      <div class="row3">
        <div>
          <label for="squat">Squat (kg)</label>
          <input id="squat" type="number" inputmode="decimal" step="0.5" placeholder="z. B. 252.5" />
        </div>
        <div>
          <label for="bench">Bench (kg)</label>
          <input id="bench" type="number" inputmode="decimal" step="0.5" placeholder="z. B. 145" />
        </div>
        <div>
          <label for="deadlift">Deadlift (kg)</label>
          <input id="deadlift" type="number" inputmode="decimal" step="0.5" placeholder="z. B. 290.5" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="total">Total (kg) (auto)</label>
          <input id="total" type="number" step="0.5" value="0" disabled />
        </div>
        <div>
          <label>Aktion</label>
          <button id="calcBtn">Berechnen</button>
        </div>
      </div>

      <div class="kpi">
        <div class="k tier-gray" id="sCard"><b>Squat</b><span id="sScore">–</span></div>
        <div class="k tier-gray" id="bCard"><b>Bench</b><span id="bScore">–</span></div>
        <div class="k tier-gray" id="dCard"><b>Deadlift</b><span id="dScore">–</span></div>
      </div>

      <div class="medalWrap">
        <div id="totalMedal" class="medal gray">
          <div class="value" id="tScore">–</div>
          <div class="label">TOTAL SCORE</div>
          <div class="meta" id="tMeta">—</div>
        </div>
      </div>

      <div class="note" id="capsText">Caps/SDs erscheinen nach „Berechnen“.</div>
    </div>

    <!-- RIGHT -->
    <div class="card">
      <canvas id="radar" width="520" height="520"></canvas>
      <div class="tiny">Anzeige-Skala: 50–110 (nur Darstellung). Radar zeigt nur Squat/Bench/Deadlift.</div>
    </div>
  </div>

  <!-- MODAL -->
  <div id="modal" style="position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; padding:18px;">
    <div style="width:min(960px, 100%); background:#fff; border-radius:16px; padding:16px; box-shadow:0 10px 40px rgba(0,0,0,.25)">
      <div style="display:flex; justify-content:space-between; gap:12px; align-items:flex-start;">
        <div>
          <div style="font-weight:900; font-size:16px;">Deine National Strength Card</div>
          <div style="color:#444; font-size:12px; margin-top:2px;" id="modalMeta">–</div>
        </div>
        <button id="closeBtn" style="border:1px solid #ddd; background:#fff; color:#111; border-radius:12px; padding:8px 10px; cursor:pointer;">Schließen</button>
      </div>

      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:14px; margin-top:12px; align-items:start;">
        <div>
          <div class="kpi" style="grid-template-columns: repeat(3, 1fr);">
            <div class="k tier-gray" id="msCard"><b>Squat</b><span id="msScore">–</span></div>
            <div class="k tier-gray" id="mbCard"><b>Bench</b><span id="mbScore">–</span></div>
            <div class="k tier-gray" id="mdCard"><b>Deadlift</b><span id="mdScore">–</span></div>
          </div>

          <div class="medalWrap">
            <div id="mTotalMedal" class="medal gray">
              <div class="value" id="mtScore">–</div>
              <div class="label">TOTAL SCORE</div>
              <div class="meta" id="mtMeta">—</div>
            </div>
          </div>

          <div class="note" id="modalCaps" style="margin-top:10px;">–</div>
        </div>

        <div>
          <canvas id="radarModal" width="460" height="460" style="width:100%; height:auto; border:1px solid #eee; border-radius:16px; background:white;"></canvas>
        </div>
      </div>
    </div>
  </div>

<script>
/* =========================
   DATA (Raw) – eingebettet.
   Männer 100 & 110 bewusst NICHT enthalten.
   ========================= */
const data = {
  "M": {
    "53":  {"S_cap":190,"S_sd":26.13,"B_cap":127.95,"B_sd":19.05,"D_cap":220,"D_sd":34.97,"T_cap":496.89,"T_sd":85.38},
    "59":  {"S_cap":217.5,"S_sd":29.62,"B_cap":147.5,"B_sd":20.18,"D_cap":252.5,"D_sd":35.36,"T_cap":570,"T_sd":90.79},
    "66":  {"S_cap":240,"S_sd":31.12,"B_cap":162.5,"B_sd":20.57,"D_cap":277.5,"D_sd":35.92,"T_cap":630,"T_sd":93.66},
    "74":  {"S_cap":262.5,"S_sd":33.83,"B_cap":177.5,"B_sd":22.69,"D_cap":300,"D_sd":36.4,"T_cap":685,"T_sd":95.32},
    "83":  {"S_cap":282.5,"S_sd":36.2,"B_cap":190,"B_sd":25.61,"D_cap":317.5,"D_sd":38.05,"T_cap":735,"T_sd":96.95},
    "93":  {"S_cap":297.5,"S_sd":36.15,"B_cap":207.5,"B_sd":25.70,"D_cap":327.5,"D_sd":37.33,"T_cap":802.5,"T_sd":94.09},
    "105": {"S_cap":320,"S_sd":40.56,"B_cap":221,"B_sd":28.72,"D_cap":345,"D_sd":39.15,"T_cap":850,"T_sd":98.98},
    "120": {"S_cap":342.5,"S_sd":44.12,"B_cap":240,"B_sd":32.02,"D_cap":359.5,"D_sd":41.64,"T_cap":900,"T_sd":112.39},
    "120+": {"S_cap":402.5,"S_sd":54.62,"B_cap":260,"B_sd":36.7,"D_cap":366.1,"D_sd":45.1,"T_cap":980,"T_sd":130.9}
  },
  "F": {
    "43":  {"S_cap":119.3,"S_sd":18.24,"B_cap":73.1,"B_sd":11.03,"D_cap":146.3,"D_sd":20.93,"T_cap":328.1,"T_sd":49.54},
    "47":  {"S_cap":143.2,"S_sd":21.59,"B_cap":93,"B_sd":13.83,"D_cap":172.5,"D_sd":23.72,"T_cap":399.4,"T_sd":57.26},
    "52":  {"S_cap":157.5,"S_sd":20.2,"B_cap":100,"B_sd":14.57,"D_cap":183.5,"D_sd":24.21,"T_cap":420,"T_sd":59.97},
    "57":  {"S_cap":167.5,"S_sd":23.23,"B_cap":107.5,"B_sd":12.34,"D_cap":192.5,"D_sd":24.29,"T_cap":450,"T_sd":60.12},
    "63":  {"S_cap":185,"S_sd":23.66,"B_cap":115,"B_sd":13.44,"D_cap":205,"D_sd":25.44,"T_cap":485,"T_sd":65.41},
    "69":  {"S_cap":197.5,"S_sd":25.72,"B_cap":122.5,"B_sd":14.48,"D_cap":217.5,"D_sd":26.48,"T_cap":520,"T_sd":72.27},
    "76":  {"S_cap":210,"S_sd":26.75,"B_cap":130,"B_sd":15.83,"D_cap":232.5,"D_sd":27.78,"T_cap":555,"T_sd":76.57},
    "84":  {"S_cap":225,"S_sd":27.48,"B_cap":137.5,"B_sd":16.59,"D_cap":245,"D_sd":28.74,"T_cap":590,"T_sd":80.49},
    "84+": {"S_cap":240,"S_sd":30.12,"B_cap":145,"B_sd":18.01,"D_cap":260,"D_sd":31.08,"T_cap":625,"T_sd":90.03}
  }
};

/* =========================
   DOM (IDs müssen existieren)
   ========================= */
const sexEl   = document.getElementById('sex');
const wcEl    = document.getElementById('wc');
const squatEl = document.getElementById('squat');
const benchEl = document.getElementById('bench');
const deadEl  = document.getElementById('deadlift');
const totalEl = document.getElementById('total');

const sScoreEl = document.getElementById('sScore');
const bScoreEl = document.getElementById('bScore');
const dScoreEl = document.getElementById('dScore');
const tScoreEl = document.getElementById('tScore');
const tMetaEl  = document.getElementById('tMeta');

const capsTextEl = document.getElementById('capsText');

const sCard = document.getElementById('sCard');
const bCard = document.getElementById('bCard');
const dCard = document.getElementById('dCard');

const totalMedal = document.getElementById('totalMedal');

const modal = document.getElementById('modal');
const closeBtn = document.getElementById('closeBtn');
const calcBtn = document.getElementById('calcBtn');

const msScoreEl = document.getElementById('msScore');
const mbScoreEl = document.getElementById('mbScore');
const mdScoreEl = document.getElementById('mdScore');
const mtScoreEl = document.getElementById('mtScore');
const mtMetaEl  = document.getElementById('mtMeta');

const msCard = document.getElementById('msCard');
const mbCard = document.getElementById('mbCard');
const mdCard = document.getElementById('mdCard');

const mTotalMedal = document.getElementById('mTotalMedal');

const modalMetaEl = document.getElementById('modalMeta');
const modalCapsEl = document.getElementById('modalCaps');

/* =========================
   Utils
   ========================= */
function fmt(n){
  if (!Number.isFinite(n)) return '–';
  return (Math.round(n*10)/10).toFixed(1);
}

function updateTotalOnly(){
  const S = parseFloat(squatEl.value||'0');
  const B = parseFloat(benchEl.value||'0');
  const D = parseFloat(deadEl.value||'0');
  const T = S+B+D;
  totalEl.value = (Math.round(T*2)/2).toFixed(1);
}

function updateWCOptions(){
  const sex = sexEl.value;
  const wcs = Object.keys(data[sex] || {});
  wcEl.innerHTML = '';

  wcs.sort((a,b)=>{
    const an = parseFloat(String(a).replace('+',''));
    const bn = parseFloat(String(b).replace('+',''));
    if (an !== bn) return an - bn;
    return (String(a).includes('+')?1:0) - (String(b).includes('+')?1:0);
  });

  for (const wc of wcs){
    const opt = document.createElement('option');
    opt.value = wc;
    opt.textContent = wc;
    wcEl.appendChild(opt);
  }
}

function score(x, cap, sd){
  return 100 + ((x - cap) / sd) * 10;
}

function clamp(x, lo, hi){
  return Math.max(lo, Math.min(hi, x));
}

/* Tier-Definition */
function tierKeyFromScore(sc){
  if (!Number.isFinite(sc)) return 'gray';
  if (sc > 100) return 'god';
  if (sc >= 95) return 'ruby';
  if (sc >= 90) return 'gold';
  if (sc >= 80) return 'silver';
  if (sc >= 70) return 'bronze';
  return 'gray';
}

function setLiftCardTier(cardEl, tier){
  cardEl.classList.remove('tier-gray','tier-bronze','tier-silver','tier-gold','tier-ruby','tier-god');
  cardEl.classList.add('tier-' + tier);
}

function setMedalTier(medalEl, tier){
  medalEl.classList.remove('gray','bronze','silver','gold','ruby','god');
  medalEl.classList.add(tier);
}

/* Radar-Farben gekoppelt an TOTAL */
function radarColorsForTier(tier){
  switch(tier){
    case 'god':    return {stroke:'rgba(88,28,135,0.95)',  fill:'rgba(88,28,135,0.22)'};
    case 'ruby':   return {stroke:'rgba(185,28,28,0.95)',  fill:'rgba(185,28,28,0.22)'};
    case 'gold':   return {stroke:'rgba(161,98,7,0.95)',   fill:'rgba(161,98,7,0.22)'};
    case 'silver': return {stroke:'rgba(107,114,128,0.95)',fill:'rgba(107,114,128,0.20)'};
    case 'bronze': return {stroke:'rgba(146,64,14,0.95)',  fill:'rgba(146,64,14,0.22)'};
    default:       return {stroke:'rgba(55,65,81,0.85)',   fill:'rgba(55,65,81,0.14)'};
  }
}

/* =========================
   Radar (3 Achsen: S/B/D)
   ========================= */
let currentRadarStroke = 'rgba(0,0,0,0.85)';
let currentRadarFill   = 'rgba(0,0,0,0.12)';

function drawRadarOn(canvasId, scores){
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0,0,W,H);

  const labels = ['Squat','Bench','Deadlift'];
  const minV = 50, maxV = 110;
  const cx = W/2, cy = H/2;
  const R = Math.min(W,H)*0.38;

  // rings
  ctx.strokeStyle = 'rgba(0,0,0,0.15)';
  ctx.lineWidth = 1;
  const rings = [50,60,70,80,90,100,110];
  for (const v of rings){
    const r = R * ((v - minV) / (maxV - minV));
    ctx.beginPath();
    for (let i=0;i<labels.length;i++){
      const a = -Math.PI/2 + i*(2*Math.PI/labels.length);
      const x = cx + r*Math.cos(a);
      const y = cy + r*Math.sin(a);
      if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.closePath();
    ctx.stroke();
  }

  // axes + labels
  ctx.strokeStyle = 'rgba(0,0,0,0.25)';
  for (let i=0;i<labels.length;i++){
    const a = -Math.PI/2 + i*(2*Math.PI/labels.length);
    const x = cx + R*Math.cos(a);
    const y = cy + R*Math.sin(a);
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.lineTo(x,y);
    ctx.stroke();

    ctx.fillStyle = 'rgba(0,0,0,0.75)';
    ctx.font = '14px system-ui';
    const tx = cx + (R+22)*Math.cos(a);
    const ty = cy + (R+22)*Math.sin(a);
    ctx.fillText(labels[i], tx - 18, ty + 6);
  }

  // polygon
  ctx.lineWidth = 2.5;
  ctx.strokeStyle = currentRadarStroke;
  ctx.fillStyle = currentRadarFill;

  ctx.beginPath();
  for (let i=0;i<labels.length;i++){
    const v = clamp(scores[i], minV, maxV);
    const r = R * ((v - minV) / (maxV - minV));
    const a = -Math.PI/2 + i*(2*Math.PI/labels.length);
    const x = cx + r*Math.cos(a);
    const y = cy + r*Math.sin(a);
    if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.closePath();
  ctx.fill();
  ctx.stroke();
}

/* =========================
   Clear / Reset
   ========================= */
function clearOutputs(){
  sScoreEl.textContent = '–';
  bScoreEl.textContent = '–';
  dScoreEl.textContent = '–';
  tScoreEl.textContent = '–';
  tMetaEl.textContent  = '—';

  setLiftCardTier(sCard, 'gray');
  setLiftCardTier(bCard, 'gray');
  setLiftCardTier(dCard, 'gray');
  setMedalTier(totalMedal, 'gray');

  capsTextEl.textContent = 'Caps/SDs erscheinen nach „Berechnen“.';

  currentRadarStroke = 'rgba(0,0,0,0.85)';
  currentRadarFill   = 'rgba(0,0,0,0.12)';
  drawRadarOn('radar', [50,50,50]);
}

/* =========================
   Modal close
   ========================= */
closeBtn.addEventListener('click', ()=>{ modal.style.display='none'; });
modal.addEventListener('click', (e)=>{ if (e.target === modal) modal.style.display='none'; });

/* =========================
   Calculate
   ========================= */
calcBtn.addEventListener('click', ()=>{
  const sex = sexEl.value;
  const wc = wcEl.value;
  const ref = (data[sex] || {})[wc];

  if (!ref){
    alert('Keine Daten für diese Auswahl.');
    return;
  }

  const S = parseFloat(squatEl.value||'0');
  const B = parseFloat(benchEl.value||'0');
  const D = parseFloat(deadEl.value||'0');
  const T = S+B+D;
  totalEl.value = (Math.round(T*2)/2).toFixed(1);

  const sSc = score(S, ref.S_cap, ref.S_sd);
  const bSc = score(B, ref.B_cap, ref.B_sd);
  const dSc = score(D, ref.D_cap, ref.D_sd);
  const tSc = score(T, ref.T_cap, ref.T_sd);

  // Text
  sScoreEl.textContent = fmt(sSc);
  bScoreEl.textContent = fmt(bSc);
  dScoreEl.textContent = fmt(dSc);
  tScoreEl.textContent = fmt(tSc);
  tMetaEl.textContent  = `Total (kg): ${fmt(T)}`;

  // Lift tiers (individuell)
  setLiftCardTier(sCard, tierKeyFromScore(sSc));
  setLiftCardTier(bCard, tierKeyFromScore(bSc));
  setLiftCardTier(dCard, tierKeyFromScore(dSc));

  // Total tier -> Medal + Radar color
  const tTier = tierKeyFromScore(tSc);
  setMedalTier(totalMedal, tTier);
  const rc = radarColorsForTier(tTier);
  currentRadarStroke = rc.stroke;
  currentRadarFill   = rc.fill;

  // Caps/SDs (Desktop sichtbar, Mobile hidden)
  capsTextEl.innerHTML =
    `Caps (P99.5=100): S ${ref.S_cap} / B ${ref.B_cap} / D ${ref.D_cap} / T ${ref.T_cap}<br>`+
    `SD (10 Punkte = 1 SD): S ${ref.S_sd} / B ${ref.B_sd} / D ${ref.D_sd} / T ${ref.T_sd}`;

  // Radar main
  drawRadarOn('radar', [sSc,bSc,dSc]);

  // Modal fill
  msScoreEl.textContent = fmt(sSc);
  mbScoreEl.textContent = fmt(bSc);
  mdScoreEl.textContent = fmt(dSc);
  mtScoreEl.textContent = fmt(tSc);
  mtMetaEl.textContent  = `Total (kg): ${fmt(T)}`;

  setLiftCardTier(msCard, tierKeyFromScore(sSc));
  setLiftCardTier(mbCard, tierKeyFromScore(bSc));
  setLiftCardTier(mdCard, tierKeyFromScore(dSc));
  setMedalTier(mTotalMedal, tTier);

  modalMetaEl.textContent = `${sex==='M'?'Männer':'Frauen'} · ${wc} kg · Raw`;
  modalCapsEl.innerHTML =
    `Eingaben: S ${fmt(S)} / B ${fmt(B)} / D ${fmt(D)} / T ${fmt(T)}<br>`+
    `Caps (P99.5=100): S ${ref.S_cap} / B ${ref.B_cap} / D ${ref.D_cap} / T ${ref.T_cap}<br>`+
    `SD (10 Punkte = 1 SD): S ${ref.S_sd} / B ${ref.B_sd} / D ${ref.D_sd} / T ${ref.T_sd}`;

  // modal radar uses same radar colors
  drawRadarOn('radarModal', [sSc,bSc,dSc]);

  modal.style.display='flex';
});

/* =========================
   Wiring
   ========================= */
sexEl.addEventListener('change', ()=>{ updateWCOptions(); clearOutputs(); });
wcEl.addEventListener('change', clearOutputs);
[squatEl, benchEl, deadEl].forEach(el => el.addEventListener('input', updateTotalOnly));

/* =========================
   Init (stabil)
   ========================= */
function init(){
  updateWCOptions();
  updateTotalOnly();
  clearOutputs();
}

if (document.readyState === 'loading'){
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
</script>
</body>
</html>

